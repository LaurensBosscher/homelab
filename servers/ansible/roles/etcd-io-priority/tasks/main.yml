---
- name: Create systemd drop-in directory for k3s
  ansible.builtin.file:
    path: /etc/systemd/system/k3s.service.d
    state: directory
    mode: "0755"

- name: Configure IO priority for etcd process (native systemd)
  ansible.builtin.copy:
    dest: /etc/systemd/system/k3s.service.d/etcd-io-priority.conf
    content: |
      [Service]
      # Set highest IO priority for etcd process (embedded in k3s)
      # Real-time IO scheduling class (1) with highest priority (0)
      IOSchedulingClass=realtime
      IOSchedulingPriority=0
    mode: "0644"
  notify: reload and restart k3s

