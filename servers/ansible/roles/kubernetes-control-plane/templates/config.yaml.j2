flannel-backend: wireguard-native
flannel-external-ip: true
flannel-iface: eth0

prefer-bundled-bin: true

node-external-ip: {{ eth0_ip }}  # Advertises eth0 IP for external access

# Disable Traefik (use your own ingress controller)
disable: traefik

# Enable secret encryption at rest
secrets-encryption: true

# etcd tunings for high-latency multi-region WAN cluster
etcd-arg:
  - 'log-level=warn'  # Since etcd logs end-up mixed with the K3S logs make it less verbose

  # WAN optimizations - increased timeouts for cross-region latency
  - "heartbeat-interval=500"             # Default 100ms, increased for WAN latency
  - "election-timeout=5000"              # Default 1000ms, increased for WAN latency
  - "grpc-keepalive-interval=30000"      # 30s keepalive for WAN connections
  - "grpc-keepalive-timeout=20000"       # 20s timeout

  # Optional: speeds up large snapshot transfers a lot (K3s â‰¥ v1.21.5)
  - "max-request-bytes=10485760"         # 10 MiB instead of ~1.5 MiB
  - "warning-apply-duration=750000000"   # 750ms warning threshold

  # PREVENTS DATABASE BLOAT: Auto-compact revisions older than 1 hour
  # Without this, etcd keeps ALL historical revisions forever
  # 1h = good balance for hobby cluster (keeps history for debugging, prevents unbounded growth)
  - "auto-compaction-retention=1h"
  - "auto-compaction-mode=periodic"

  # Keep default 2GB quota - you hit 900MB, so 2GB gives 2x headroom
  # Only increase if you consistently hit quota alarms

# Automated etcd snapshots (backup + size management)
etcd-snapshot-schedule-cron: "0 */12 * * *"  # Every 12 hours (reasonable for hobby)
etcd-snapshot-retention: 5

kube-controller-manager-arg:
  - "node-monitor-period=10s"
  - "node-monitor-grace-period=60s"

kubelet-arg:
  - "config=/etc/rancher/k3s/kubelet-config.yaml"

# SELinux support (set to true to enable enforcement after policies are installed)
selinux: false


